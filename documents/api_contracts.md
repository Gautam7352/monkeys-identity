# API Contracts

This file contains the request and response details for the `monkeys-identity` service APIs, generated by testing against a running local instance.

## Table of Contents
- [Public APIs](#public-apis)
- [Authentication APIs](#authentication-apis)
- [User Management APIs](#user-management-apis)
- [Organization Management APIs](#organization-management-apis)
- [Group Management APIs](#group-management-apis)
- [Resource Management APIs](#resource-management-apis)
- [Policy Management APIs](#policy-management-apis)
- [Role Management APIs](#role-management-apis)
- [Session Management APIs](#session-management-apis)
- [Service Account APIs](#service-account-apis)
- [Authorization APIs](#authorization-apis)
- [Audit & Compliance APIs](#audit--compliance-apis)
- [Admin APIs](#admin-apis)

---

## Public APIs

### GET /api/v1/public/health
**Request**
```bash
curl -v http://localhost:8085/api/v1/public/health
```
**Response**
```json
{
  "service": "monkeys-iam",
  "status": "ok"
}
```

## Authentication APIs

### POST /api/v1/auth/create-admin
**Request**
```bash
curl -v -X POST -H "Content-Type: application/json" -d @admin_create.json http://localhost:8085/api/v1/auth/create-admin
```
**Payload (`admin_create.json`)**
```json
{
  "username": "admin",
  "email": "admin@monkeys.com",
  "password": "password123",
  "display_name": "Admin User"
}
```
**Response**
```json
{
  "success": true,
  "message": "Admin user created successfully",
  "data": {
    "username": "admin",
    "email": "admin@monkeys.com",
    "role": "admin"
  }
}
```

### POST /api/v1/auth/login
**Request**
```bash
curl -v -X POST -H "Content-Type: application/json" -d @login.json http://localhost:8085/api/v1/auth/login
```
**Payload (`login.json`)**
```json
{
  "email": "admin@monkeys.com",
  "password": "password123"
}
```
**Response**
```json
{
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 3600,
    "token_type": "Bearer",
    "user": {
      "id": "5685aa34-18de-4e28-969a-a5825108b202",
      "username": "admin",
      "email": "admin@monkeys.com",
      "email_verified": true,
      "display_name": "Admin User",
      "avatar_url": "",
      "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
      "password_changed_at": "0001-01-01T00:00:00Z",
      "mfa_enabled": false,
      "mfa_methods": null,
      "attributes": "",
      "preferences": "",
      "last_login": "2025-12-11T04:33:00.29754Z",
      "failed_login_attempts": 0,
      "locked_until": "0001-01-01T00:00:00Z",
      "status": "active",
      "created_at": "2025-12-11T04:32:45.809521Z",
      "updated_at": "2025-12-11T04:33:00.298177Z",
      "deleted_at": "0001-01-01T00:00:00Z"
    }
  },
  "success": true
}
```

## User Management APIs

### GET /api/v1/users
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/users
```
**Response**
```json
{
  "success": true,
  "data": [
    {
      "id": "5685aa34-18de-4e28-969a-a5825108b202",
      "username": "admin",
      "email": "admin@monkeys.com",
      "email_verified": true,
      "display_name": "Admin User",
      "avatar_url": "",
      "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
      "password_changed_at": "0001-01-01T00:00:00Z",
      "mfa_enabled": false,
      "mfa_methods": null,
      "attributes": "",
      "preferences": "",
      "last_login": "2025-12-11T04:33:00.29754Z",
      "failed_login_attempts": 0,
      "locked_until": "0001-01-01T00:00:00Z",
      "status": "active",
      "created_at": "2025-12-11T04:32:45.809521Z",
      "updated_at": "2025-12-11T04:33:00.298177Z",
      "deleted_at": "0001-01-01T00:00:00Z"
    }
  ]
}
```

### POST /api/v1/users
**Request**
```bash
curl -v -X POST -H "Content-Type: application/json" -H "Authorization: Bearer <access_token>" -d @create_user.json http://localhost:8085/api/v1/users
```
**Payload (`create_user.json`)**
```json
{
  "username": "testuser",
  "email": "testuser@monkeys.com",
  "password": "testpass123",
  "display_name": "Test User",
  "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5"
}
```
**Response**
```json
{
  "data": {
    "id": "94d69ef9-1768-4fa0-815a-a35c8cd1736f",
    "username": "testuser",
    "email": "testuser@monkeys.com",
    "email_verified": false,
    "display_name": "Test User",
    "avatar_url": "",
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "password_changed_at": "0001-01-01T00:00:00Z",
    "mfa_enabled": false,
    "mfa_methods": null,
    "attributes": "",
    "preferences": "",
    "last_login": "0001-01-01T00:00:00Z",
    "failed_login_attempts": 0,
    "locked_until": "0001-01-01T00:00:00Z",
    "status": "active",
    "created_at": "2025-12-11T04:50:17.345763348Z",
    "updated_at": "2025-12-11T04:50:17.345763528Z",
    "deleted_at": "0001-01-01T00:00:00Z"
  },
  "message": "User created successfully",
  "success": true
}
```

### GET /api/v1/users/:id
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f
```
**Response**
```json
{
  "success": true,
  "data": {
    "id": "94d69ef9-1768-4fa0-815a-a35c8cd1736f",
    "username": "testuser",
    "email": "testuser@monkeys.com",
    "email_verified": false,
    "display_name": "Test User",
    "avatar_url": "",
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "password_changed_at": "0001-01-01T00:00:00Z",
    "mfa_enabled": false,
    "mfa_methods": null,
    "attributes": "",
    "preferences": "",
    "last_login": "0001-01-01T00:00:00Z",
    "failed_login_attempts": 0,
    "locked_until": "0001-01-01T00:00:00Z",
    "status": "active",
    "created_at": "2025-12-11T04:50:17.345763Z",
    "updated_at": "2025-12-11T04:50:17.345764Z",
    "deleted_at": "0001-01-01T00:00:00Z"
  }
}
```

### PUT /api/v1/users/:id
**Request**
```bash
curl -v -X PUT -H "Content-Type: application/json" -H "Authorization: Bearer <access_token>" -d @update_user.json http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f
```
**Payload (`update_user.json`)**
```json
{
  "display_name": "Updated Test User",
  "avatar_url": "https://example.com/avatar.jpg"
}
```
**Response** (500 Internal Server Error)
```json
{
  "error": "Internal server error",
  "success": false
}
```

### GET /api/v1/users/:id/profile
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f/profile
```
**Response**
```json
{
  "success": true,
  "data": {
    "id": "94d69ef9-1768-4fa0-815a-a35c8cd1736f",
    "username": "testuser",
    "email": "testuser@monkeys.com",
    "email_verified": false,
    "display_name": "Test User",
    "avatar_url": "",
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "password_changed_at": "0001-01-01T00:00:00Z",
    "mfa_enabled": false,
    "mfa_methods": null,
    "attributes": "",
    "preferences": "",
    "last_login": "0001-01-01T00:00:00Z",
    "failed_login_attempts": 0,
    "locked_until": "0001-01-01T00:00:00Z",
    "status": "active",
    "created_at": "2025-12-11T04:50:17.345763Z",
    "updated_at": "2025-12-11T04:50:17.345764Z",
    "deleted_at": "0001-01-01T00:00:00Z"
  }
}
```

### PUT /api/v1/users/:id/profile
**Request**
```bash
curl -v -X PUT -H "Content-Type: application/json" -H "Authorization: Bearer <access_token>" -d @update_profile.json http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f/profile
```
**Payload (`update_profile.json`)**
```json
{
  "bio": "This is my bio",
  "location": "San Francisco",
  "website": "https://example.com"
}
```
**Response** (400 Bad Request)
```json
{
  "error": "Invalid request body",
  "success": false
}
```

### POST /api/v1/users/:id/suspend
**Request**
```bash
curl -v -X POST -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f/suspend
```
**Response** (400 Bad Request)
```json
{
  "error": "Invalid request body",
  "success": false
}
```

### POST /api/v1/users/:id/activate
**Request**
```bash
curl -v -X POST -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f/activate
```
**Response**
```json
{
  "message": "User activated successfully",
  "success": true
}
```

### GET /api/v1/users/:id/sessions
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f/sessions
```
**Response**
```json
{
  "data": null,
  "success": true
}
```

### DELETE /api/v1/users/:id/sessions
**Request**
```bash
curl -v -X DELETE -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f/sessions
```
**Response**
```json
{
  "message": "User sessions revoked successfully",
  "success": true
}
```

### DELETE /api/v1/users/:id
**Request**
```bash
curl -v -X DELETE -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/users/94d69ef9-1768-4fa0-815a-a35c8cd1736f
```
**Response**
```json
{
  "message": "User deleted successfully",
  "success": true
}
}
```


## Organization Management APIs

### GET /api/v1/organizations
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations
```
**Response**
```json
{
    "status": 200,
    "message": "Organizations retrieved",
    "data": {
        "items": [
            {
                "id": "3af735c9-d301-4146-9a1d-d6ee77e15553",
                "name": "Updated Test Organization",
                "slug": "test-org-3",
                "parent_id": null,
                "description": "Updated description for testing",
                "metadata": "{}",
                "settings": "{\"maintenance_mode\": false, \"allow_public_signup\": true, \"max_session_duration\": 3600}",
                "billing_tier": "",
                "max_users": 0,
                "max_resources": 0,
                "status": "active",
                "created_at": "2025-12-11T06:27:07.562309Z",
                "updated_at": "2025-12-11T06:48:50.663143Z",
                "deleted_at": null
            },
            {
                "id": "d86e8a6d-d6f0-4e06-8368-5a3319d4255c",
                "name": "Test Organization",
                "slug": "test-org",
                "parent_id": null,
                "description": "Test organization for API testing",
                "metadata": "{}",
                "settings": "{}",
                "billing_tier": "free",
                "max_users": 100,
                "max_resources": 1000,
                "status": "active",
                "created_at": "2025-12-11T05:42:05.546886Z",
                "updated_at": "2025-12-11T05:42:05.546886Z",
                "deleted_at": null
            },
            {
                "id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
                "name": "Default Organization",
                "slug": "default",
                "parent_id": null,
                "description": null,
                "metadata": "{}",
                "settings": "{}",
                "billing_tier": "standard",
                "max_users": 1000,
                "max_resources": 10000,
                "status": "active",
                "created_at": "2025-12-11T04:32:45.809523Z",
                "updated_at": "2025-12-11T04:32:45.809523Z",
                "deleted_at": null
            },
            {
                "id": "00000000-0000-0000-0000-000000000000",
                "name": "System",
                "slug": "system",
                "parent_id": null,
                "description": "System organization for global resources and policies",
                "metadata": "{}",
                "settings": "{}",
                "billing_tier": "standard",
                "max_users": 1000,
                "max_resources": 10000,
                "status": "active",
                "created_at": "2025-12-11T04:31:43.02512Z",
                "updated_at": "2025-12-11T04:31:43.02512Z",
                "deleted_at": null
            }
        ],
        "total": 4,
        "limit": 50,
        "offset": 0,
        "has_more": false,
        "total_pages": 0
    }
}
```

### GET /api/v1/organizations/:id
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations/c98c4b3c-9789-4f0b-9ed4-181c70dd61e5
```
**Response**
```json
{
  "status": 200,
  "message": "Organization retrieved",
  "data": {
    "id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "name": "Default Organization",
    "slug": "default",
    "description": "Default organization for the system",
    "domain": "",
    "logo_url": "",
    "website": "",
    "industry": "",
    "size": "",
    "country": "",
    "timezone": "",
    "language": "",
    "billing_email": "",
    "support_email": "",
    "max_users": 1000,
    "max_resources": 10000,
    "status": "active",
    "created_at": "2025-12-11T04:32:45.809523Z",
    "updated_at": "2025-12-11T04:32:45.809523Z",
    "deleted_at": null
  }
}
```

### GET /api/v1/organizations/:id/users
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations/c98c4b3c-9789-4f0b-9ed4-181c70dd61e5/users
```
**Response** (✅ FIXED - was returning 500 error)
```json
{
  "status": 200,
  "message": "Users retrieved",
  "data": {
    "count": 1,
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "users": [
      {
        "id": "5685aa34-18de-4e28-969a-a5825108b202",
        "username": "admin",
        "email": "admin@monkeys.com",
        "email_verified": true,
        "display_name": "Admin User",
        "avatar_url": "",
        "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
        "password_changed_at": "0001-01-01T00:00:00Z",
        "mfa_enabled": false,
        "mfa_methods": [],
        "attributes": "",
        "preferences": "",
        "last_login": "2025-12-11T05:33:00.297185Z",
        "failed_login_attempts": 0,
        "locked_until": "0001-01-01T00:00:00Z",
        "status": "active",
        "created_at": "2025-12-11T04:32:45.809521Z",
        "updated_at": "2025-12-11T05:41:06.855861Z",
        "deleted_at": "0001-01-01T00:00:00Z"
      }
    ]
  }
}
```

### GET /api/v1/organizations/:id/groups
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations/c98c4b3c-9789-4f0b-9ed4-181c70dd61e5/groups
```
**Response**
```json
{
  "status": 200,
  "message": "Groups retrieved",
  "data": {
    "count": 0,
    "groups": [],
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5"
  }
}
```

### GET /api/v1/organizations/:id/resources
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations/c98c4b3c-9789-4f0b-9ed4-181c70dd61e5/resources
```
**Response**
```json
{
  "status": 200,
  "message": "Resources retrieved",
  "data": {
    "count": 0,
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "resources": []
  }
}
```

### GET /api/v1/organizations/:id/policies
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations/c98c4b3c-9789-4f0b-9ed4-181c70dd61e5/policies
```
**Response** (✅ FIXED - was returning 500 error)
```json
{
  "status": 200,
  "message": "Policies retrieved",
  "data": {
    "count": 1,
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "policies": [
      {
        "id": "8a36888c-8039-4f6a-9828-c55a04b23729",
        "name": "FullAccess",
        "description": "Allows full access to all resources",
        "version": "1.0",
        "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
        "document": "{}",
        "policy_type": "managed",
        "effect": "allow",
        "is_system_policy": false,
        "created_by": "",
        "approved_by": "",
        "approved_at": "0001-01-01T00:00:00Z",
        "status": "active",
        "created_at": "2025-12-11T04:32:45.809523Z",
        "updated_at": "2025-12-11T04:32:45.809523Z",
        "deleted_at": "0001-01-01T00:00:00Z"
      }
    ]
  }
}
```

### GET /api/v1/organizations/:id/roles
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations/c98c4b3c-9789-4f0b-9ed4-181c70dd61e5/roles
```
**Response** (✅ FIXED - was returning 500 error)
```json
{
  "status": 200,
  "message": "Roles retrieved",
  "data": {
    "count": 1,
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "roles": [
      {
        "id": "30d94c09-fd3b-42e9-a1f6-3fa057fe88a4",
        "name": "admin",
        "description": "Administrator role",
        "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
        "role_type": "standard",
        "max_session_duration": "1h",
        "trust_policy": "{}",
        "assume_role_policy": "{}",
        "tags": "{}",
        "is_system_role": false,
        "path": "/",
        "permissions_boundary": "",
        "status": "active",
        "created_at": "2025-12-11T04:32:45.809523Z",
        "updated_at": "2025-12-11T04:32:45.809523Z",
        "deleted_at": "0001-01-01T00:00:00Z"
      }
    ]
  }
}
```

### POST /api/v1/organizations
**Request**
```bash
curl -v -X POST -H "Content-Type: application/json" -H "Authorization: Bearer <access_token>" -d '{
  "name": "Test Organization 2",
  "slug": "test-org-2",
  "description": "Second test organization for API testing"
}' http://localhost:8085/api/v1/organizations
```
**Response**
```json
{
  "status": 201,
  "message": "Organization created",
  "data": {
    "id": "91fc0291-cb6e-4ae0-be7d-51846e09f0b0",
    "name": "Test Organization 2",
    "slug": "test-org-2",
    "parent_id": null,
    "description": "Second test organization for API testing",
    "metadata": "{}",
    "settings": "{}",
    "billing_tier": "free",
    "max_users": 100,
    "max_resources": 1000,
    "status": "active",
    "created_at": "2025-12-11T06:19:09.946392Z",
    "updated_at": "2025-12-11T06:19:09.946392Z",
    "deleted_at": null
  }
}
```

### GET /api/v1/organizations/:id/settings
**Request**
```bash
curl -v -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations/c98c4b3c-9789-4f0b-9ed4-181c70dd61e5/settings
```
**Response**
```json
{
  "status": 200,
  "message": "Settings retrieved",
  "data": {
    "organization_id": "c98c4b3c-9789-4f0b-9ed4-181c70dd61e5",
    "settings": "{}"
  }
}
```



### PUT /api/v1/organizations/:id
**Request**
```bash
curl -v -X PUT -H "Content-Type: application/json" -H "Authorization: Bearer <access_token>" -d '{
  "name": "Updated Test Organization",
  "description": "Updated description for testing"
}' http://localhost:8085/api/v1/organizations/3af735c9-d301-4146-9a1d-d6ee77e15553
```
**Response** (✅ FIXED - was returning 500 error)
```json
{
  "status": 200,
  "message": "Organization updated",
  "data": {
    "id": "3af735c9-d301-4146-9a1d-d6ee77e15553",
    "name": "Updated Test Organization",
    "slug": "",
    "parent_id": null,
    "description": "Updated description for testing",
    "metadata": "{}",
    "settings": "{}",
    "billing_tier": "",
    "max_users": 0,
    "max_resources": 0,
    "status": "active",
    "created_at": "0001-01-01T00:00:00Z",
    "updated_at": "2025-12-11T06:40:39.826059Z",
    "deleted_at": null
  }
}
```

### PUT /api/v1/organizations/:id/settings
**Request**
```bash
curl -v -X PUT -H "Content-Type: application/json" -H "Authorization: Bearer <access_token>" -d '{
  "settings": "{\"maintenance_mode\":false,\"allow_public_signup\":true,\"max_session_duration\":3600}"
}' http://localhost:8085/api/v1/organizations/3af735c9-d301-4146-9a1d-d6ee77e15553/settings
```
**Response**
```json
{
  "status": 200,
  "message": "Settings updated",
  "data": {
    "organization_id": "3af735c9-d301-4146-9a1d-d6ee77e15553"
  }
}
```

### DELETE /api/v1/organizations/:id
**Request**
```bash
curl -v -X DELETE -H "Authorization: Bearer <access_token>" http://localhost:8085/api/v1/organizations/91fc0291-cb6e-4ae0-be7d-51846e09f0b0
```
**Response**
```json
{
  "status": 200,
  "message": "Organization deleted",
  "data": {
    "organization_id": "91fc0291-cb6e-4ae0-be7d-51846e09f0b0",
    "deleted_at": "2025-12-11T06:25:15.123456Z"
  }
}
```
